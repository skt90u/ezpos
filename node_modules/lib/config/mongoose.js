var mongoose = require( 'mongoose' ),
	logger   = require( 'lib/logger' )(__filename);
	  
var bootstrapDb = function( options ) {

	var config  = options.config;
	var uri     = config.db.uri;
	var options = config.db.options;
	
	if(mongoose.connection.db) return;

    mongoose.connection.on( 'error',         logger.error);
    mongoose.connection.on( 'disconnected',  function(){logger.info('{0} has been disconnected, retry to connect database', uri); bootstrapDb( config ); } );
    mongoose.connection.on( 'connecting',    function(){logger.info('connecting to {0}', uri );});
    mongoose.connection.on( 'connected',     function(){logger.info('{0} has been connected', uri );});
    mongoose.connection.on( 'disconnecting', function(){logger.info('disconnecting from {0}', uri );});
    mongoose.connection.on( 'open',          function(){logger.info('{0} has been opened', uri );});

	mongoose.connect( uri, options );
};

module.exports = bootstrapDb;